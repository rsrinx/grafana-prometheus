# PromQL Cheat Sheet - –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ Prometheus

## üìä –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ò–µ—Ä–∞—Ä—Ö–∏—è –¥–∞–Ω–Ω—ã—Ö
```
–ú–µ—Ç—Ä–∏–∫–∞ (Metric)
  ‚îî‚îÄ –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ (Time Series) = —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –º–µ—Ç–æ–∫
       ‚îî‚îÄ –û–±—Ä–∞–∑–µ—Ü (Sample) = –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
```

**–ü—Ä–∏–º–µ—Ä:**
```
http_requests_total                           ‚Üê –ú–µ—Ç—Ä–∏–∫–∞
  {method="GET", status="200"}                ‚Üê –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ 1
    10:00:00 ‚Üí 1542                           ‚Üê –û–±—Ä–∞–∑–µ—Ü 1
    10:01:00 ‚Üí 1687                           ‚Üê –û–±—Ä–∞–∑–µ—Ü 2
  {method="POST", status="200"}               ‚Üê –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ 2
    10:00:00 ‚Üí 837                            ‚Üê –û–±—Ä–∞–∑–µ—Ü 3
```

### –ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å (Cardinality)
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –º–µ—Ç–æ–∫ = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤**

‚ùå **–í—ã—Å–æ–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–ü–õ–û–•–û):**
```promql
http_requests{user_id="12345"}  
# –ú–∏–ª–ª–∏–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = –º–∏–ª–ª–∏–æ–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ = üí∏üí∏üí∏
```

‚úÖ **–ù–∏–∑–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–•–û–†–û–®–û):**
```promql
http_requests{method="GET", status="200"}
# ~10 –º–µ—Ç–æ–¥–æ–≤ √ó ~10 —Å—Ç–∞—Ç—É—Å–æ–≤ = ~100 –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ ‚úÖ
```

---

## üî¢ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### 1. Instant Vector (–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä)
–ù–∞–±–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Å **–æ–¥–Ω–∏–º** –∑–Ω–∞—á–µ–Ω–∏–µ–º –Ω–∞ –∫–∞–∂–¥—ã–π —Ä—è–¥ (—Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç)
```promql
http_requests_total
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞
```

### 2. Range Vector (–í–µ–∫—Ç–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞)
–ù–∞–±–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Å **–Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏** –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏
```promql
http_requests_total[5m]
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
```

### 3. Scalar (–°–∫–∞–ª—è—Ä)
–ü—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ –±–µ–∑ –º–µ—Ç–æ–∫ –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏
```promql
42
3.14
100
```

---

## üéØ –°–µ–ª–µ–∫—Ç–æ—Ä—ã (–í—ã–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)

### –°–µ–ª–µ–∫—Ç–æ—Ä –º–µ—Ç—Ä–∏–∫–∏
```promql
http_requests_total
# –í—ã–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫—É –ø–æ –∏–º–µ–Ω–∏
```

### –°–µ–ª–µ–∫—Ç–æ—Ä –º–µ—Ç–æ–∫ (Label Selector)
```promql
# –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
http_requests_total{method="GET"}

# –ù–µ —Ä–∞–≤–Ω–æ
http_requests_total{status!="200"}

# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (—Å–æ–≤–ø–∞–¥–∞–µ—Ç)
http_requests_total{path=~"/api/.*"}

# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç)
http_requests_total{path!~"/internal/.*"}

# –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
http_requests_total{method="GET", status="200", path="/api/users"}
```

### –°–µ–ª–µ–∫—Ç–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (Range Selector)
```promql
http_requests_total[5m]   # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
http_requests_total[1h]   # –ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
http_requests_total[24h]  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
http_requests_total[7d]   # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```

**–ï–¥–∏–Ω–∏—Ü—ã –≤—Ä–µ–º–µ–Ω–∏:**
- `ms` - –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
- `s` - —Å–µ–∫—É–Ω–¥—ã
- `m` - –º–∏–Ω—É—Ç—ã
- `h` - —á–∞—Å—ã
- `d` - –¥–Ω–∏
- `w` - –Ω–µ–¥–µ–ª–∏
- `y` - –≥–æ–¥—ã

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä Offset (–°–º–µ—â–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º–µ–Ω–∏)
```promql
http_requests_total offset 5m
# –ó–Ω–∞—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥

http_requests_total[5m] offset 1h
# –î–∏–∞–ø–∞–∑–æ–Ω 5 –º–∏–Ω—É—Ç, –Ω–∞—á–∏–Ω–∞—è —Å —á–∞—Å–∞ –Ω–∞–∑–∞–¥

# –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Å —á–∞—Å–æ–º –Ω–∞–∑–∞–¥
http_requests_total - http_requests_total offset 1h
```

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä @ (–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏)
```promql
http_requests_total @ 1686561123
# –ó–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç (Unix timestamp)

http_requests_total[5m] @ 1686561123
# –î–∏–∞–ø–∞–∑–æ–Ω 5 –º–∏–Ω—É—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç timestamp
```

---

## ‚ûï –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å–∫–∞–ª—è—Ä–∞–º–∏
```promql
http_requests_total * 2
# –£–º–Ω–æ–∂–∏—Ç—å –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ 2

http_requests_total + 100
# –î–æ–±–∞–≤–∏—Ç—å 100 –∫ –∫–∞–∂–¥–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é

(memory_used / memory_total) * 100
# –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏
```promql
# –°–ª–æ–∂–µ–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –í–°–ï–ú –º–µ—Ç–∫–∞–º)
vector_a + vector_b

# –í—ã—á–∏—Ç–∞–Ω–∏–µ
requests_total - errors_total

# –£–º–Ω–æ–∂–µ–Ω–∏–µ
cpu_cores * cpu_usage_percent / 100

# –î–µ–ª–µ–Ω–∏–µ
memory_used / memory_total

# –û—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è
counter_value % 1000

# –í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å
latency_ms ^ 2
```

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã:** `+`, `-`, `*`, `/`, `%`, `^`

---

## üîç –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
```promql
# –í–µ—Ä–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–≤–Ω—ã–µ 200
http_status == 200

# –ù–µ —Ä–∞–≤–Ω–æ
http_status != 200

# –ë–æ–ª—å—à–µ
temperature > 80

# –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
cpu_usage >= 90

# –ú–µ–Ω—å—à–µ
response_time < 100

# –ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
error_rate <= 0.01
```

**–û–ø–µ—Ä–∞—Ç–æ—Ä—ã:** `==`, `!=`, `>`, `<`, `>=`, `<=`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å bool:**
```promql
# –í–µ—Ä–Ω—É—Ç—å 1 (true) –∏–ª–∏ 0 (false) –≤–º–µ—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
http_status == bool 200
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å 200, –∏–Ω–∞—á–µ 0
```

---

## üìä –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

### –ë–∞–∑–æ–≤–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è
```promql
# –°—É–º–º–∞ –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
sum(http_requests_total)

# –°—Ä–µ–¥–Ω–µ–µ
avg(response_time_seconds)

# –ú–∏–Ω–∏–º—É–º
min(temperature_celsius)

# –ú–∞–∫—Å–∏–º—É–º
max(memory_usage_bytes)

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
count(up)

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
stddev(response_time_seconds)

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è
stdvar(response_time_seconds)
```

### –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π (by)
```promql
# –°—É–º–º–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É –º–µ—Ç–æ–¥—É
sum by (method) (http_requests_total)

# –°—Ä–µ–¥–Ω–µ–µ CPU –ø–æ —Ä–µ–≥–∏–æ–Ω—É –∏ –∑–æ–Ω–µ
avg by (region, zone) (cpu_usage)

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
max by (app) (memory_usage_bytes)
```

### –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º (without)
```promql
# –°—É–º–º–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –º–µ—Ç–∫—É instance
sum without (instance) (http_requests_total)

# –°—Ä–µ–¥–Ω–µ–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è pod –∏ container
avg without (pod, container) (cpu_usage)
```

### –¢–æ–ø-N –∏ Bottom-N
```promql
# –¢–æ–ø-5 —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ CPU
topk(5, cpu_usage)

# 5 –Ω–∞–∏–º–µ–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
bottomk(5, cpu_usage)

# –¢–æ–ø-10 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø—Ä–æ—Å–æ–≤
topk(10, sum by (endpoint) (rate(http_requests_total[5m])))
```

### –ö–≤–∞–Ω—Ç–∏–ª–∏ (Percentiles)
```promql
# 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –∑–∞–¥–µ—Ä–∂–∫–∏
quantile(0.95, response_time_seconds)

# 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –ø–æ —Å–µ—Ä–≤–∏—Å—É
quantile(0.99, response_time_seconds) by (service)
```

**–í—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
`sum`, `avg`, `min`, `max`, `stddev`, `stdvar`, `count`, `count_values`, `bottomk`, `topk`, `quantile`, `group`

---

## üîó –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ (Vector Matching)

### –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–≤—Å–µ –º–µ—Ç–∫–∏)
```promql
vector_a + vector_b
# –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ –í–°–ï–ú –æ–±—â–∏–º –º–µ—Ç–∫–∞–º
# –ö–∞–∫ INNER JOIN –≤ SQL –ø–æ –≤—Å–µ–º –∫–æ–ª–æ–Ω–∫–∞–º
```

### on() - —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –º–µ—Ç–∫–∞–º
```promql
# –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ pod
memory_used / on(pod) memory_limit

# –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ pod –∏ namespace
requests / on(pod, namespace) request_limit

# –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
(memory_used / on(pod, namespace) memory_total) * 100
```

### ignoring() - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
```promql
# –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ –≤—Å–µ–º –º–µ—Ç–∫–∞–º, –∫—Ä–æ–º–µ instance
cpu_usage + ignoring(instance) cpu_limit

# –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å pod –∏ container
memory_used + ignoring(pod, container) memory_cached
```

### group_left - –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º (LEFT JOIN)
```promql
# –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏ –∫ –º–µ—Ç—Ä–∏–∫–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤
# –ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–ª–µ–≤–∞) ‚Üí –æ–¥–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏ (—Å–ø—Ä–∞–≤–∞)
http_requests * on(service) group_left(version) service_info

# –° –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–µ—Ç–∫–∞–º–∏
requests * on(pod) group_left(version, team) pod_metadata
```

### group_right - –º–Ω–æ–≥–∏–µ-–∫-–æ–¥–Ω–æ–º—É (RIGHT JOIN)
```promql
# –û–±—Ä–∞—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ group_left
service_info * on(service) group_right(method) http_requests
```

### –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

#### and - –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ (INNER JOIN)
```promql
# –í–µ—Ä–Ω—É—Ç—å –º–µ—Ç—Ä–∏–∫–∏ CPU —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–∞–º—è—Ç–∏
cpu_usage and memory_usage

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—ã
pod_status and up == 1
```

#### unless - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (LEFT JOIN WHERE NULL)
```promql
# –í–µ—Ä–Ω—É—Ç—å –º–µ—Ç—Ä–∏–∫–∏, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï–¢ –∞–ª–µ—Ä—Ç–æ–≤
up unless ALERTS{alertname="InstanceDown"}

# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—ã –±–µ–∑ –æ—à–∏–±–æ–∫
pod_status unless pod_errors > 0
```

#### or - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ (UNION)
```promql
# –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ CPU –∏–ª–∏ –ø–∞–º—è—Ç–∏
cpu_usage or memory_usage

# –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
metric_source_a or metric_source_b
```

---

## üìà –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ (Counters)

### rate() - —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥—É
```promql
# –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
rate(http_requests_total[5m])

# –û—à–∏–±–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É
rate(http_errors_total[1m])

# –ë–∞–π—Ç –≤ —Å–µ–∫—É–Ω–¥—É
rate(network_bytes_total[5m])
```

### irate() - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Ç–æ—á–∫–∏)
```promql
# –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∫ –≤—Å–ø–ª–µ—Å–∫–∞–º)
irate(http_requests_total[5m])

# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –º–µ—Ç—Ä–∏–∫
irate(cpu_usage_total[1m])
```

**–†–∞–∑–Ω–∏—Ü–∞ rate vs irate:**
- `rate()` - —É—Å—Ä–µ–¥–Ω—è–µ—Ç –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥ (–ø–ª–∞–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫)
- `irate()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ 2 –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–æ—á–∫–∏ (—Ä–µ–∞–≥–∏—Ä—É–µ—Ç –±—ã—Å—Ç—Ä–µ–µ)

### increase() - –æ–±—â–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥
```promql
# –°–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã–ª–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
increase(http_requests_total[1h])

# –°–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
increase(errors_total[5m])
```

### resets() - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±—Ä–æ—Å–æ–≤ —Å—á–µ—Ç—á–∏–∫–∞
```promql
# –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å—á–µ—Ç—á–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏)
resets(http_requests_total[1h])
```

---

## üìâ –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è gauge (–∏–∑–º–µ—Ä–µ–Ω–∏–π)

### delta() - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥
```promql
# –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∑–∞ —á–∞—Å
delta(temperature_celsius[1h])

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
delta(memory_usage_bytes[5m])
```

### deriv() - –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è (—Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)
```promql
# –°–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
deriv(temperature_celsius[5m])
```

### predict_linear() - –ª–∏–Ω–µ–π–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
```promql
# –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 1 —á–∞—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 15 –º–∏–Ω—É—Ç
predict_linear(disk_usage_bytes[15m], 3600)

# –ö–æ–≥–¥–∞ –¥–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è (–µ—Å–ª–∏ —Ç—Ä–µ–Ω–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è)
predict_linear(disk_free_bytes[1h], 86400) < 0
```

---

## ‚è±Ô∏è –§—É–Ω–∫—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏

### –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏

```promql
# –°—Ä–µ–¥–Ω–µ–µ –∑–∞ 5 –º–∏–Ω—É—Ç
avg_over_time(cpu_usage[5m])

# –ú–∞–∫—Å–∏–º—É–º –∑–∞ —á–∞—Å
max_over_time(temperature[1h])

# –ú–∏–Ω–∏–º—É–º –∑–∞ –¥–µ–Ω—å
min_over_time(response_time[24h])

# –°—É–º–º–∞ –∑–∞ 5 –º–∏–Ω—É—Ç
sum_over_time(errors_total[5m])

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–∑—Ü–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
count_over_time(up[10m])

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
stddev_over_time(latency[5m])

# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏—Å–ø–µ—Ä—Å–∏—è
stdvar_over_time(latency[5m])

# –ö–≤–∞–Ω—Ç–∏–ª—å –∑–∞ –ø–µ—Ä–∏–æ–¥
quantile_over_time(0.95, response_time[5m])
```

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
```promql
# –¢–µ–∫—É—â–µ–µ Unix –≤—Ä–µ–º—è
time()

# –ö–æ–≥–¥–∞ –º–µ—Ç—Ä–∏–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –º–µ–Ω—è–ª–∞—Å—å
timestamp(metric_name)

# –°–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø—Ä–æ—à–ª–æ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
time() - timestamp(metric_name)
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–∏
```promql
# –¢–µ–∫—É—â–∏–π –≥–æ–¥
year()

# –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (1-12)
month()

# –î–µ–Ω—å –º–µ—Å—è—Ü–∞ (1-31)
day_of_month()

# –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0=–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6=–°—É–±–±–æ—Ç–∞)
day_of_week()

# –ß–∞—Å (0-23)
hour()

# –ú–∏–Ω—É—Ç–∞ (0-59)
minute()
```

---

## üî¢ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ
```promql
# –û–∫—Ä—É–≥–ª–∏—Ç—å –¥–æ —Ü–µ–ª–æ–≥–æ
round(cpu_usage)

# –û–∫—Ä—É–≥–ª–∏—Ç—å –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
round(cpu_usage, 0.01)

# –û–∫—Ä—É–≥–ª–∏—Ç—å –≤–≤–µ—Ä—Ö
ceil(response_time)

# –û–∫—Ä—É–≥–ª–∏—Ç—å –≤–Ω–∏–∑
floor(response_time)
```

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```promql
# –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
abs(-5)  # –†–µ–∑—É–ª—å—Ç–∞—Ç: 5

# –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å
sqrt(16)  # –†–µ–∑—É–ª—å—Ç–∞—Ç: 4

# –≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞
exp(2)

# –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –ª–æ–≥–∞—Ä–∏—Ñ–º
ln(10)

# –õ–æ–≥–∞—Ä–∏—Ñ–º –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 2
log2(8)  # –†–µ–∑—É–ª—å—Ç–∞—Ç: 3

# –õ–æ–≥–∞—Ä–∏—Ñ–º –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—é 10
log10(100)  # –†–µ–∑—É–ª—å—Ç–∞—Ç: 2
```

### –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è
```promql
# –°–∏–Ω—É—Å, –∫–æ—Å–∏–Ω—É—Å, —Ç–∞–Ω–≥–µ–Ω—Å
sin(x)
cos(x)
tan(x)

# –û–±—Ä–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
asin(x)
acos(x)
atan(x)
```

### –≠–∫—Å—Ç—Ä–µ–º—É–º—ã
```promql
# –ë–æ–ª—å—à–∏–π –∏–∑ (–≤–µ–∫—Ç–æ—Ä, —Å–∫–∞–ª—è—Ä)
clamp_min(temperature, 0)  # –ú–∏–Ω–∏–º—É–º 0

# –ú–µ–Ω—å—à–∏–π –∏–∑ (–≤–µ–∫—Ç–æ—Ä, —Å–∫–∞–ª—è—Ä)
clamp_max(cpu_usage, 100)  # –ú–∞–∫—Å–∏–º—É–º 100
```

---

## üéØ –§—É–Ω–∫—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### changes() - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–Ω–∞—á–µ–Ω–∏—è
```promql
# –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–µ—Ç—Ä–∏–∫–∞ –º–µ–Ω—è–ª–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ —á–∞—Å
changes(metric[1h])
```

### –°–∫–∞—á–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
```promql
# –î–µ–ª—å—Ç–∞ –º–µ–∂–¥—É —Ç–µ–∫—É—â–∏–º –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
idelta(metric[5m])
```

---

## üìä –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º

### histogram_quantile() - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–µ–π
```promql
# 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–∑ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
histogram_quantile(
  0.95,
  rate(http_request_duration_seconds_bucket[5m])
)

# 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
histogram_quantile(
  0.99,
  sum by (le, endpoint) (rate(http_request_duration_seconds_bucket[5m]))
)
```

**–í–∞–∂–Ω–æ:** –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö —Ç–∏–ø–∞ `_bucket` —Å –º–µ—Ç–∫–æ–π `le` (less or equal)

---

## üîÑ –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

```promql
# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
sort(metric)

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é
sort_desc(metric)
```

---

## üé® –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç–∫–∞–º–∏

### label_join() - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–∫
```promql
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–µ—Ç–∫—É –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
label_join(
  up,
  "instance_region",  # –Ω–æ–≤–∞—è –º–µ—Ç–∫–∞
  "-",                # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
  "instance",         # –∏—Å—Ö–æ–¥–Ω–∞—è –º–µ—Ç–∫–∞ 1
  "region"            # –∏—Å—Ö–æ–¥–Ω–∞—è –º–µ—Ç–∫–∞ 2
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: instance_region="server1-us-east"
```

### label_replace() - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–∫ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
```promql
# –ò–∑–≤–ª–µ—á—å —á–∞—Å—Ç—å –º–µ—Ç–∫–∏
label_replace(
  metric,
  "short_name",           # –Ω–æ–≤–∞—è –º–µ—Ç–∫–∞
  "$1",                   # —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
  "instance",             # –∏—Å—Ö–æ–¥–Ω–∞—è –º–µ—Ç–∫–∞
  "([^:]+):.*"           # regex
)
# instance="server1:8080" ‚Üí short_name="server1"
```

---

## üö® –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

### absent() - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ç—Ä–∏–∫–∏
```promql
# –í–µ—Ä–Ω–µ—Ç 1 –µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
absent(up{job="api"})

# –ê–ª–µ—Ä—Ç –µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∞ –∏—Å—á–µ–∑–ª–∞
ALERT MetricMissing
IF absent(critical_metric)
FOR 5m
```

### absent_over_time() - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥
```promql
# –í–µ—Ä–Ω–µ—Ç 1 –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
absent_over_time(metric[5m])
```

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ HTTP
```promql
# –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
rate(http_requests_total[5m])

# –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –ø–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞–º
sum by (status) (rate(http_requests_total[5m]))

# –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫
sum(rate(http_requests_total{status=~"5.."}[5m]))
/
sum(rate(http_requests_total[5m]))
* 100

# –¢–æ–ø-10 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É
topk(10, sum by (endpoint) (rate(http_requests_total[5m])))

# 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –∑–∞–¥–µ—Ä–∂–∫–∏
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))

# –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
rate(http_request_duration_seconds_sum[5m])
/
rate(http_request_duration_seconds_count[5m])
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```promql
# –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)

# –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100

# –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ (%)
(node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏ (–≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –ú–±–∏—Ç/—Å)
rate(node_network_receive_bytes_total[5m]) * 8 / 1000000

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∏—Å–∫–∞ —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞
predict_linear(node_filesystem_free_bytes[1h], 4*3600) < 0
```

### Kubernetes –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```promql
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Running
sum(kube_pod_status_phase{phase="Running"})

# –†–µ—Å—Ç–∞—Ä—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
increase(kube_pod_container_status_restarts_total[1h]) > 0

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –ø–æ namespace
sum by (namespace) (rate(container_cpu_usage_seconds_total[5m]))

# –¢–æ–ø-5 –ø–æ–¥–æ–≤ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–∞–º—è—Ç–∏
topk(5, container_memory_usage_bytes{container!=""})

# –ü–æ–¥—ã –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤ –ø–∞–º—è—Ç–∏
count(kube_pod_container_info) 
unless 
count(kube_pod_container_resource_limits{resource="memory"})
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—à–ª—ã–º
```promql
# –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ —Å —á–∞—Å–æ–º –Ω–∞–∑–∞–¥
rate(http_requests_total[5m])
/
rate(http_requests_total[5m] offset 1h)

# –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –Ω–µ–¥–µ–ª—é
(
  rate(metric[5m])
  -
  rate(metric[5m] offset 7d)
)
/
rate(metric[5m] offset 7d)
* 100

# –î–µ–ª—å—Ç–∞ –º–µ–∂–¥—É —Å–µ–≥–æ–¥–Ω—è –∏ –≤—á–µ—Ä–∞ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è
metric - (metric offset 24h)
```

### SLA –∏ SLO
```promql
# Availability (uptime %)
avg_over_time(up[30d]) * 100

# Success rate (99% –∑–∞–ø—Ä–æ—Å–æ–≤ —É—Å–ø–µ—à–Ω—ã)
sum(rate(http_requests_total{status=~"2.."}[5m]))
/
sum(rate(http_requests_total[5m]))
> 0.99

# Latency SLO (95% –∑–∞–ø—Ä–æ—Å–æ–≤ < 200ms)
histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) < 0.2

# Error budget (—Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –º–æ–∂–µ–º —Å–µ–±–µ –ø–æ–∑–≤–æ–ª–∏—Ç—å)
1 - (
  sum(rate(http_requests_total{status=~"5.."}[30d]))
  /
  sum(rate(http_requests_total[30d]))
)
```

---

## üéì –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ DO (–î–µ–ª–∞–π—Ç–µ —Ç–∞–∫)
```promql
# 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ rate() –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤
rate(http_requests_total[5m])

# 2. –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Ä–∞–∑—É–º–Ω–æ (–Ω–∏–∑–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
sum by (service, method) (rate(http_requests_total[5m]))

# 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ recording rules –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
# –í–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:
histogram_quantile(0.95, rate(http_duration_bucket[5m]))
# –°–æ–∑–¥–∞–π—Ç–µ recording rule:
job:http_latency:p95

# 4. –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –º–µ—Ç–∫–∏ —Ä–∞–Ω–æ
rate(http_requests_total{status=~"5.."}[5m])

# 5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ irate() —Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –º–µ—Ç—Ä–∏–∫
irate(network_packets_total[1m])
```

### ‚ùå DON'T (–ù–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫)
```promql
# 1. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—ã—Å–æ–∫–æ–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏
{user_id="12345"}  # –ü–õ–û–•–û - –º–∏–ª–ª–∏–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π

# 2. –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ rate() –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤
http_requests_total  # –ü–õ–û–•–û - –ø–æ–∫–∞–∂–µ—Ç –æ–±—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
rate(http_requests_total[5m])  # –•–û–†–û–®–û

# 3. –ù–µ –≥—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –ø–æ –≤—Å–µ–º –º–µ—Ç–∫–∞–º
sum by (instance, pod, container, namespace) (...)  # –ü–õ–û–•–û
sum by (service) (...)  # –•–û–†–û–®–û

# 4. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
rate(metric[30s])  # –ü–õ–û–•–û - —Å–ª–∏—à–∫–æ–º —à—É–º–Ω–æ
rate(metric[5m])   # –•–û–†–û–®–û

# 5. –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ offset –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
metric - metric offset 1h  # –ù–µ –ø—Ä–æ—Å—Ç–æ metric - metric
```

---

## üÜö PromQL vs SQL - –ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

| SQL | PromQL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|--------|----------|
| `SELECT *` | `metric_name` | –í—ã–±—Ä–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ |
| `WHERE column = value` | `{label="value"}` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| `WHERE column LIKE '%pattern%'` | `{label=~".*pattern.*"}` | Regex —Ñ–∏–ª—å—Ç—Ä |
| `JOIN ON column` | `on(label)` | –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ |
| `LEFT JOIN` | `group_left` | –û–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º |
| `INNER JOIN` | `and` | –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ |
| `LEFT JOIN WHERE NULL` | `unless` | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ |
| `UNION` | `or` | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ |
| `GROUP BY column` | `by (label)` | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ |
| `SUM(column)` | `sum(metric)` | –ê–≥—Ä–µ–≥–∞—Ü–∏—è |
| `AVG(column)` | `avg(metric)` | –°—Ä–µ–¥–Ω–µ–µ |
| `COUNT(*)` | `count(metric)` | –ü–æ–¥—Å—á–µ—Ç |
| `ORDER BY DESC LIMIT 10` | `topk(10, metric)` | –¢–æ–ø-N |

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PromQL:** https://prometheus.io/docs/prometheus/latest/querying/basics/
- **–§—É–Ω–∫—Ü–∏–∏ PromQL:** https://prometheus.io/docs/prometheus/latest/querying/functions/
- **–û–ø–µ—Ä–∞—Ç–æ—Ä—ã PromQL:** https://prometheus.io/docs/prometheus/latest/querying/operators/
- **–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:** https://prometheus.io/docs/prometheus/latest/querying/examples/
- **PromQL Playground:** https://demo.promlabs.com/

---

## ‚ö° –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –≤ Grafana

- `Ctrl + Space` - –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- `Shift + Enter` - –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
- `Ctrl + /` - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- `Ctrl + K` - –ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏