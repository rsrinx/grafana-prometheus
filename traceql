TraceQL Cheat Sheet üîç
–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ —è–∑—ã–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ Grafana Tempo

üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
Trace (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞)
‚îú‚îÄ trace_id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤—Å–µ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
‚îî‚îÄ Spans (–æ—Ç—Ä–µ–∑–∫–∏)
   ‚îú‚îÄ span_id: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –æ–ø–µ—Ä–∞—Ü–∏–∏
   ‚îú‚îÄ parent_id: ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ span'–∞
   ‚îú‚îÄ start/end: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
   ‚îî‚îÄ attributes: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ


üè∑Ô∏è –¢–∏–ø—ã –ø–æ–ª–µ–π
–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–æ–ª—è (Intrinsic Fields)
–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ span'–∞—Ö, –¥–æ—Å—Ç—É–ø–Ω–∞—è –≤—Å–µ–≥–¥–∞:
–ü–æ–ª–µ
–û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π
status
–°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
ok, error, unset
statusMessage
–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
"Internal Server Error"
duration
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å span'–∞
100ms, 2s
name
–ò–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏
"GET /api/users"
kind
–¢–∏–ø span'–∞
server, client, internal, producer, consumer
traceDuration
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
500ms
rootName
–ò–º—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ span'–∞
"frontend"
rootServiceName
–ò–º—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
"api-gateway"

–ü–æ–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (Attribute Fields)
Span –∞—Ç—Ä–∏–±—É—Ç—ã - –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:
span.http.method          // HTTP –º–µ—Ç–æ–¥
span.http.status_code     // HTTP –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞
span.http.url             // URL –∑–∞–ø—Ä–æ—Å–∞
span.db.system            // –¢–∏–ø –ë–î (postgresql, mysql)
span.db.statement         // SQL –∑–∞–ø—Ä–æ—Å
span.user.id              // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

Resource –∞—Ç—Ä–∏–±—É—Ç—ã - –æ–ø–∏—Å—ã–≤–∞—é—Ç —Å–µ—Ä–≤–∏—Å:
resource.service.name         // –ò–º—è —Å–µ—Ä–≤–∏—Å–∞
resource.service.version      // –í–µ—Ä—Å–∏—è
resource.k8s.namespace.name   // Kubernetes namespace
resource.k8s.pod.name         // –ò–º—è pod'–∞
resource.host.name            // –ò–º—è —Ö–æ—Å—Ç–∞
resource.container.id         // ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

üí° –°–æ–≤–µ—Ç: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ . –≤ –Ω–∞—á–∞–ª–µ, –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ —Ç–∏–ø –∞—Ç—Ä–∏–±—É—Ç–∞:
.http.method    // –ù–∞–π–¥—ë—Ç span.http.method –∏–ª–∏ resource.http.method


üîç –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
–û–ø–µ—Ä–∞—Ç–æ—Ä
–û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–∏–º–µ—Ä
=
–†–∞–≤–Ω–æ
{ status = error }
!=
–ù–µ —Ä–∞–≤–Ω–æ
{ span.http.method != "GET" }
>
–ë–æ–ª—å—à–µ
{ duration > 100ms }
>=
–ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
{ span.http.status_code >= 400 }
<
–ú–µ–Ω—å—à–µ
{ duration < 50ms }
<=
–ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
{ span.http.status_code <= 299 }
=~
Regex —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
{ span.http.url =~ "/api/.*" }
!~
Regex –ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç
{ span.http.url !~ ".*health.*" }


üß© –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
–í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –±–ª–æ–∫–∞ {}
// AND - –≤—Å–µ —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è
{ span.http.method = "POST" && duration > 500ms }
{ status = error && resource.service.name = "payment-service" }

// OR - —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ
{ span.http.status_code = 500 || span.http.status_code = 503 }

–ú–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏
// AND –º–µ–∂–¥—É –Ω–∞–±–æ—Ä–∞–º–∏ span'–æ–≤
{ status = error } && { duration > 1s }

// OR –º–µ–∂–¥—É –Ω–∞–±–æ—Ä–∞–º–∏ span'–æ–≤
{ status = error } || { duration > 2s }


üå≥ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
> - –ü—Ä—è–º–æ–π –ø–æ—Ç–æ–º–æ–∫ (child)
// –ù–∞–π—Ç–∏ span'—ã, –≥–¥–µ frontend –ù–ê–ü–†–Ø–ú–£–Æ –≤—ã–∑—ã–≤–∞–µ—Ç database
{ resource.service.name = "frontend" } > { span.db.system = "postgresql" }

‚îå‚îÄ frontend ‚îÄ‚îê
‚îî‚îÄ‚îÄ> database ‚îÄ‚îò  ‚úÖ –ù–∞–π–¥–µ–Ω–æ!

>> - –õ—é–±–æ–π –ø–æ—Ç–æ–º–æ–∫ (descendant)
// –ù–∞–π—Ç–∏ span'—ã, –≥–¥–µ frontend –≤—ã–∑—ã–≤–∞–µ—Ç database (–≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã)
{ resource.service.name = "frontend" } >> { span.db.system = "postgresql" }

‚îå‚îÄ frontend ‚îÄ‚îê
‚îî‚îÄ‚îÄ> checkout ‚îÄ‚îê
    ‚îî‚îÄ‚îÄ> database ‚îÄ‚îò  ‚úÖ –ù–∞–π–¥–µ–Ω–æ!

~ - –°–æ—Å–µ–¥–Ω–∏–µ span'—ã (siblings)
// –ù–∞–π—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã
{ resource.service.name = "inventory" } ~ { resource.service.name = "pricing" }

‚îå‚îÄ parent ‚îÄ‚îê
‚îú‚îÄ‚îÄ> inventory ‚îÄ‚îò  ‚úÖ
‚îî‚îÄ‚îÄ> pricing ‚îÄ‚îÄ‚îÄ‚îò  ‚úÖ –û–±–∞ siblings!


üìä –§—É–Ω–∫—Ü–∏–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (Tempo 2.4+)
–ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
// –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (requests per second)
{ } | rate() by (resource.service.name)

// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ span'–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
{ status = error } | count_over_time() by (span.http.status_code)

// –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
{ span.http.method = "POST" } | avg_over_time(duration) by (span.http.route)

// –°—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π
{ } | sum_over_time(span.db.rows_affected) by (resource.service.name)

// –ú–∏–Ω–∏–º—É–º/–ú–∞–∫—Å–∏–º—É–º
{ } | min_over_time(duration)
{ } | max_over_time(duration)

–ö–≤–∞–Ω—Ç–∏–ª–∏ –∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
// 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å latency
{ } | quantile_over_time(duration, 0.95) by (resource.service.name)

// 50-–π (–º–µ–¥–∏–∞–Ω–∞), 90-–π, 99-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏
{ } | quantile_over_time(duration, 0.50)
{ } | quantile_over_time(duration, 0.90)
{ } | quantile_over_time(duration, 0.99)

// –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞
{ } | histogram_over_time(duration) by (span.http.route)

–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (Tempo 2.5+)
// –¢–æ–ø-5 —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
{ } | avg_over_time(duration) by (span.http.route) | topk(5)

// 10 —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—à–∏–±–æ–∫
{ status = error } | rate() by (resource.service.name) | topk(10)

// –¢–æ–ø-3 —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
{ } | avg_over_time(duration) by (name) | bottomk(3)

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ
// –°—Ä–∞–≤–Ω–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –º–µ–∂–¥—É –ø–µ—Ä–∏–æ–¥–∞–º–∏
{ } | rate() | compare(1h)


üíº –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
üî¥ –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
// –í—Å–µ –æ—à–∏–±–∫–∏
{ status = error }

// –û—à–∏–±–∫–∏ 5xx –≤ API
{ span.http.status_code >= 500 }

// –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ
{ status = error && resource.service.name = "payment-service" }

// –û—à–∏–±–∫–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ
{ status = error && span.http.url =~ "/api/checkout.*" }

‚è±Ô∏è –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
// –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (> 1 —Å–µ–∫—É–Ω–¥—ã)
{ duration > 1s }

// –ú–µ–¥–ª–µ–Ω–Ω—ã–µ POST –∑–∞–ø—Ä–æ—Å—ã
{ span.http.method = "POST" && duration > 500ms }

// –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
{ span.db.system = "postgresql" && duration > 200ms }

// –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –¥–æ–ª—å—à–µ 5 —Å–µ–∫—É–Ω–¥
{ traceDuration > 5s }

üéØ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
// –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ checkout
{ span.http.url =~ ".*checkout.*" }

// –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
{ span.user.id = "user_12345" }

// –ó–∞–ø—Ä–æ—Å—ã –∏–∑ production –æ–∫—Ä—É–∂–µ–Ω–∏—è
{ resource.deployment.environment = "production" }

// SQL –∑–∞–ø—Ä–æ—Å—ã —Å SELECT
{ span.db.statement =~ "SELECT.*" }

üîó –ê–Ω–∞–ª–∏–∑ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
// Frontend –≤—ã–∑—ã–≤–∞–µ—Ç –ª—é–±—É—é –ë–î
{ resource.service.name = "frontend" } >> { span.db.system != "" }

// API Gateway -> Auth -> Payment (—Ü–µ–ø–æ—á–∫–∞)
{ resource.service.name = "api-gateway" } 
  >> { resource.service.name = "auth-service" }
  >> { resource.service.name = "payment-service" }

// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã inventory –∏ pricing
{ resource.service.name = "inventory" } ~ { resource.service.name = "pricing" }

üìà RED –º–µ—Ç—Ä–∏–∫–∏ (Rate, Errors, Duration)
// Rate - —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
{ resource.service.name = "checkout-service" } | rate()

// Errors - —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫
{ resource.service.name = "checkout-service" && status = error } | rate()

// Duration - —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
{ resource.service.name = "checkout-service" } | avg_over_time(duration)

// –í—Å—ë –≤–º–µ—Å—Ç–µ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
{ } | rate() by (resource.service.name, span.http.route)
{ status = error } | rate() by (resource.service.name)
{ } | quantile_over_time(duration, 0.95) by (resource.service.name)

üêõ –û—Ç–ª–∞–¥–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã
// –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –æ—à–∏–±–∫–∞–º–∏
{ duration > 1s && status = error }

// –¢–∞–π–º–∞—É—Ç—ã –≤ payment service
{ resource.service.name = "payment-service" 
  && span.http.status_code = 504 }

// Deadlock'–∏ –≤ –ë–î
{ span.db.system = "postgresql" 
  && statusMessage =~ ".*deadlock.*" }

// –ó–∞–ø—Ä–æ—Å—ã, –ø—Ä–æ—Ö–æ–¥—è—â–∏–µ —á–µ—Ä–µ–∑ –±–æ–ª–µ–µ 5 —Å–µ—Ä–≤–∏—Å–æ–≤
{ } | count() by (trace_id) > 5


üé® –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
Group by (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)
// –ü–æ –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–∏—Å–∞
{ } | rate() by (resource.service.name)

// –ü–æ HTTP –º–µ—Ç–æ–¥—É –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É
{ } | avg_over_time(duration) by (span.http.method, span.http.route)

// –ü–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥—É
{ } | count_over_time() by (span.http.status_code)

// –ü–æ namespace –≤ Kubernetes
{ } | rate() by (resource.k8s.namespace.name)


‚ö° –ü–æ–ª–µ–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
Healthcheck –∏—Å–∫–ª—é—á–µ–Ω–∏—è
// –ò—Å–∫–ª—é—á–∏—Ç—å health checks –∏–∑ –∞–Ω–∞–ª–∏–∑–∞
{ span.http.url !~ ".*health.*" && span.http.url !~ ".*ping.*" }

–ê–Ω–∞–ª–∏–∑ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Time Range Picker –≤ Grafana –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
// –ó–∞—Ç–µ–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –≤ —ç—Ç–æ–º –ø–µ—Ä–∏–æ–¥–µ

–ü–æ–∏—Å–∫ –∞–Ω–æ–º–∞–ª–∏–π
// –ó–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ
{ duration > 2s }

// –ù–µ–æ–±—ã—á–Ω—ã–µ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥—ã
{ span.http.status_code >= 400 && span.http.status_code < 600 }

// –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
{ span.retry.count > 0 }


üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚úÖ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
// ‚úÖ –•–û–†–û–®–û: –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤
{ span.http.method = "POST" }
{ resource.service.name = "payment-service" }

// ‚úÖ –•–û–†–û–®–û: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
{ resource.service.name = "payment-service" && duration > 100ms }

// ‚úÖ –•–û–†–û–®–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
{ status = error }  // status –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è

‚ùå –ò–∑–±–µ–≥–∞–π—Ç–µ
// ‚ö†Ô∏è –ú–ï–î–õ–ï–ù–ù–û: –ë–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ)
{ .http.method = "POST" }

// ‚ö†Ô∏è –ú–ï–î–õ–ï–ù–ù–û: –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–µ —É—Å–ª–æ–≤–∏—è
{ duration > 0 }  // –í–µ—Ä–Ω—ë—Ç –ø–æ—á—Ç–∏ –≤—Å—ë

// ‚ö†Ô∏è –ú–ï–î–õ–ï–ù–ù–û: –°–ª–æ–∂–Ω—ã–µ regex –±–µ–∑ —è–∫–æ—Ä–µ–π
{ span.http.url =~ ".*" }  // –°–ª–∏—à–∫–æ–º –æ–±—â–µ–µ


üìö –ß–∞—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SLO/SLA
// –ó–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ 200ms (—É—Å–ø–µ—Ö –¥–ª—è SLO)
{ duration < 200ms } | count_over_time()

// –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
{ status = ok } | rate() / { } | rate()

// P95 latency –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
{ span.http.route = "/api/checkout" } 
  | quantile_over_time(duration, 0.95)

Capacity Planning
// –°–∞–º—ã–µ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
{ } | rate() by (resource.service.name) | topk(10)

// –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏
{ } | sum_over_time(duration) by (span.http.route) | topk(5)

Incident Response
// –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞?
{ status = error && resource.service.name = "payment-service" }

// –ö–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã?
{ status = error } | rate() by (resource.service.name)

// –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
{ status = error } >> { status = error }


üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
–°–≤—è–∑—å —Å –ª–æ–≥–∞–º–∏ (Loki)
// –ù–∞–π—Ç–∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É, –∑–∞—Ç–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å —Ç–µ–º –∂–µ trace_id
// –í Grafana: –∫–ª–∏–∫ –Ω–∞ span -> "Logs for this span"

–°–≤—è–∑—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ (Prometheus)
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TraceQL metrics –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–ª–µ—Ä—Ç–æ–≤ –≤ Prometheus
// –ò–ª–∏ Service Graph –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π


üí° –°–æ–≤–µ—Ç—ã –∏ —Ç—Ä—é–∫–∏
–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ: –°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏—Ç–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏, –∑–∞—Ç–µ–º —É—Ç–æ—á–Ω—è–π—Ç–µ

 { status = error }  // –ù–∞—á–∞—Ç—å –æ—Ç—Å—é–¥–∞
{ status = error && resource.service.name = "payment" }  // –£—Ç–æ—á–Ω–∏—Ç—å


–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Service Graph: –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã


–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏: JSON export –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞


–ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ —Å Logs: Trace ID –≤ –ª–æ–≥–∞—Ö ‚Üí –±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–µ


–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã: –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ Grafana



üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://grafana.com/docs/tempo/latest/traceql/
–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤: https://grafana.com/blog/traceql-examples/
TraceQL Playground: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Grafana –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

–í–µ—Ä—Å–∏—è: Tempo 2.5+ (–¥–µ–∫–∞–±—Ä—å 2025)
 –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: Grafana 10.4+
üí° –°–æ–≤–µ—Ç: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —à–ø–∞—Ä–≥–∞–ª–∫—É –∏ –¥–µ—Ä–∂–∏—Ç–µ –ø–æ–¥ —Ä—É–∫–æ–π –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Tempo!

