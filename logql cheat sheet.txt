# LogQL Cheat Sheet - –®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º

## üîç –ë–∞–∑–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### –°–µ–ª–µ–∫—Ç–æ—Ä—ã –ø–æ—Ç–æ–∫–æ–≤ –ª–æ–≥–æ–≤
```logql
{job="varlogs"}
# –í—ã–±—Ä–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏ —Å –º–µ—Ç–∫–æ–π job="varlogs"

{service_name="load-generator", namespace="default"}
# –í—ã–±—Ä–∞—Ç—å –ª–æ–≥–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–µ—Ç–∫–∞–º–∏ (AND)

{service_name=~".*-service"}
# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞ "-service"

{service_name!="test"}
# –ò—Å–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å "test"
```

### –¢–µ–∫—Å—Ç–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```logql
{job="app"} |= "error"
# –°–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–æ "error"

{job="app"} != "debug"
# –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–æ "debug"

{job="app"} |~ "error|ERROR|Error"
# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: –ª—é–±–∞—è —Ñ–æ—Ä–º–∞ —Å–ª–æ–≤–∞ error

{job="app"} !~ "debug|trace"
# –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç debug –∏–ª–∏ trace
```

---

## üì¶ –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

### JSON –ø–∞—Ä—Å–∏–Ω–≥
```logql
{service_name="api"} | json
# –†–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏ –∏–∑–≤–ª–µ—á—å –≤—Å–µ –ø–æ–ª—è

{service_name="api"} | json | severity="ERROR"
# –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—é severity

{service_name="api"} | json user_id="user", level="severity"
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª—è: user_id ‚Üí user, severity ‚Üí level
```

### Logfmt –ø–∞—Ä—Å–∏–Ω–≥
```logql
{job="app"} | logfmt
# –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∞ key=value

{job="app"} | logfmt | level="error"
# –ü–∞—Ä—Å–∏–Ω–≥ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```

### Regexp –ø–∞—Ä—Å–∏–Ω–≥
```logql
{job="app"} | regexp "User (?P<user_id>[a-f0-9-]+) (?P<action>\\w+)"
# –ò–∑–≤–ª–µ—á—å user_id –∏ action —Å –ø–æ–º–æ—â—å—é —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

{job="nginx"} | regexp `(?P<method>\\w+) (?P<path>/\\S+) (?P<status>\\d{3})`
# –ò–∑–≤–ª–µ—á—å HTTP –º–µ—Ç–æ–¥, –ø—É—Ç—å –∏ —Å—Ç–∞—Ç—É—Å –∫–æ–¥
```

---

## ‚úèÔ∏è –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞

### Line format
```logql
{job="app"} | json | line_format "{{.severity}}: {{.body}}"
# –ü–µ—Ä–µ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É: INFO: User logged in

{job="app"} | json | line_format "{{.timestamp}} [{{.level | upper}}] {{.message}}"
# –° —Ñ—É–Ω–∫—Ü–∏–µ–π upper: 2025-12-02 [ERROR] Something went wrong

{job="app"} | json | line_format "{{.user_id}} - {{.action}} - {{.product_id}}"
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞
```

### Label format
```logql
{job="app"} | json | label_format env="{{.environment}}"
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–µ—Ç–∫—É env –∏–∑ –ø–æ–ª—è environment

{job="app"} | json | label_format level="{{.severity | upper}}"
# –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∫—É —Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º

{job="app"} | json | label_format new_name="{{.old_name}}"
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∫—É (—Å—Ç–∞—Ä–∞—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è)

{job="app"} | json | label_format new_name=old_name
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –º–µ—Ç–∫—É (—Å—Ç–∞—Ä–∞—è —É–¥–∞–ª–∏—Ç—Å—è)
```

---

## üî¢ –ú–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã

### –ü–æ–¥—Å—á–µ—Ç –∏ —Å–∫–æ—Ä–æ—Å—Ç—å
```logql
count_over_time({job="app"}[5m])
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç

rate({job="app"}[1m])
# –°–∫–æ—Ä–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∑–∞–ø–∏—Å–µ–π –≤ —Å–µ–∫—É–Ω–¥—É) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É

sum(rate({job="app"} |= "error" [5m]))
# –û–±—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ—à–∏–±–æ–∫

sum by (service) (rate({namespace="prod"}[5m]))
# –°–∫–æ—Ä–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É —Å–µ—Ä–≤–∏—Å—É
```

### –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö
```logql
bytes_rate({job="app"}[5m])
# –°–∫–æ—Ä–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ –≤ –±–∞–π—Ç–∞—Ö/—Å–µ–∫

bytes_over_time({job="app"}[1h])
# –û–±—â–∏–π –æ–±—ä–µ–º –ª–æ–≥–æ–≤ –∑–∞ —á–∞—Å
```

### –¢–æ–ø –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```logql
topk(10, sum by (service) (rate({namespace="prod"}[5m])))
# –¢–æ–ø-10 —Å–∞–º—ã—Ö "–±–æ–ª—Ç–ª–∏–≤—ã—Ö" —Å–µ—Ä–≤–∏—Å–æ–≤

bottomk(5, count_over_time({job="app"}[1h]))
# 5 –Ω–∞–∏–º–µ–Ω–µ–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ª–æ–≥–æ–≤
```

---

## üìä Unwrap - —Ä–∞–±–æ—Ç–∞ —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∏–∑ –ª–æ–≥–æ–≤
```logql
{job="api"} | json | unwrap duration
# –ò–∑–≤–ª–µ—á—å —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ duration

avg_over_time({job="api"} | json | unwrap request_time [5m])
# –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –∑–∞ 5 –º–∏–Ω—É—Ç

quantile_over_time(0.95, {job="api"} | json | unwrap duration [5m])
# 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

sum by (endpoint) (
  sum_over_time({job="api"} | json | unwrap bytes_processed [10m])
)
# –û–±—â–∏–π –æ–±—ä–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –±–∞–π—Ç –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
```

### –° –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –µ–¥–∏–Ω–∏—Ü
```logql
{job="api"} | json | unwrap duration_seconds(response_time) [5m]
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–µ–∫—É–Ω–¥—ã

{job="api"} | json | unwrap bytes(size) [5m]
# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –±–∞–π—Ç—ã
```

---

## üéØ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫
```logql
sum by (service, severity) (
  count_over_time({namespace="prod"} |= "error" | json [5m])
)
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º –∏ —É—Ä–æ–≤–Ω—é —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏

rate({job="app"} |~ "(?i)error|exception|fatal" [5m])
# –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–≥–æ–≤
```logql
{job="app"} |= "User" |= "adding"
| json
| regexp `User (?P<user_id>[a-f0-9-]+) adding (?P<qty>\\d+) of product (?P<product_id>\\w+)`
| line_format "UserID: {{.user_id}} | Product: {{.product_id}} | Quantity: {{.qty}}"
# –ò–∑–≤–ª–µ—á—å –∏ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API
```logql
avg by (path) (
  avg_over_time(
    {job="nginx"} | json | path=~"/api/.*" 
    | unwrap duration [5m]
  )
)
# –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è Kubernetes
```logql
{namespace="production"} 
| json 
| resources_k8s_pod_name=~"api-.*"
| severity="ERROR"
| line_format "Pod: {{.resources_k8s_pod_name}} | {{.body}}"
# –û—à–∏–±–∫–∏ –∏–∑ API –ø–æ–¥–æ–≤ –≤ production
```

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏

### –§–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∫–∞–º
```logql
{job="app"} | json | status_code >= 500
# HTTP —Å—Ç–∞—Ç—É—Å >= 500

{job="app"} | json | response_time > 1000
# –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –±–æ–ª—å—à–µ 1000–º—Å

{job="app"} | json | __error__ = ""
# –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
```

### –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫
```logql
{job="app"} | json | drop pod_name, container_id
# –£–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
```

### –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
```logql
{job="app"} | json | status >= 400 and status < 500
# –°—Ç–∞—Ç—É—Å 4xx

{job="app"} | json | (method="POST" or method="PUT") and path="/api/users"
# POST –∏–ª–∏ PUT –Ω–∞ /api/users
```

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–±—ã—Å—Ç—Ä–æ)
```logql
{job="app"} |= "error" | json | severity="ERROR"
# –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–∫—Å—Ç—É, –ø–æ—Ç–æ–º –ø–∞—Ä—Å–∏–Ω–≥
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–æ)
```logql
{job="app"} | json | severity="ERROR"
# –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```

---

## üìù –®–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –°—Ç—Ä–æ–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```logql
{job="app"} | json | line_format "{{.message | lower}}"
# –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É

{job="app"} | json | line_format "{{.message | upper}}"
# –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É

{job="app"} | json | line_format "{{.message | title}}"
# –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è

{job="app"} | json | line_format "{{.message | trunc 50}}"
# –û–±—Ä–µ–∑–∞—Ç—å –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤
```

### –£—Å–ª–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
```logql
{job="app"} | json 
| line_format "Status: {{if eq .status \"200\"}}OK{{else}}ERROR{{end}}"
# –£—Å–ª–æ–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

---

## üéì –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã

```
[5s]   - 5 —Å–µ–∫—É–Ω–¥
[30s]  - 30 —Å–µ–∫—É–Ω–¥
[5m]   - 5 –º–∏–Ω—É—Ç
[1h]   - 1 —á–∞—Å
[1h30m] - 1 —á–∞—Å 30 –º–∏–Ω—É—Ç
[24h]  - 24 —á–∞—Å–∞
[7d]   - 7 –¥–Ω–µ–π
[2w]   - 2 –Ω–µ–¥–µ–ª–∏
```

---

## üí° –ë—ã—Å—Ç—Ä—ã–µ —Å–æ–≤–µ—Ç—ã

1. **–í—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞**: `|= "text"` –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –ø–∞—Ä—Å–∏–Ω–≥
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–∫–∏**: `{job="app"}` –±—ã—Å—Ç—Ä–µ–µ —á–µ–º `{job=~".*"}`
3. **–ò–∑–±–µ–≥–∞–π—Ç–µ –≤—ã—Å–æ–∫–æ–π –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ user_id –∫–∞–∫ –º–µ—Ç–∫—É
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞**: `| __error__ = ""`
5. **–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Ä–∞–∑—É–º–Ω–æ**: `by (service)` –≤–º–µ—Å—Ç–æ `by (service, pod, container)`

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è LogQL: https://grafana.com/docs/loki/latest/query/
- LogQL Analyzer: https://grafana.com/docs/loki/latest/query/analyzer/
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤: https://grafana.com/docs/loki/latest/query/examples/